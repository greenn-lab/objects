# 계약에 의한 설계

Design By Contract. DBC 라고 하는 군요.
줄기차게 얘기 해온 메세지를 통해 역할, 책임, 협력을 하기에 힘든 부분이 있어서 DBC 를 해야한다는 거네요.

## 01 협력과 계약
우리가 인테리어 공사를 할 때, 전문가에게 맏기고 계약서를 받는 것처럼, 계약서 라는 **문서화** 를 통해 계약을 체결하는 식으로 설계를 해야 한다는 얘긴가 봐요. 문서화를 잘하자는 걸까요?

## 02 계약에 의한 설계
오퍼레이션의 시그니처(흔히 말하는 메서드. 하지만 우리는 배운 사람들이니까) 만으로는 모든 의도를 드러낼 수 없는데 계약은 그걸 보완할 수 있다는거죠.

계약은
 - 사전조건
 - 사후조건
 - 불변식

이런 게 있군요.

**사전조건** 은 메서드 실행 전에 전제 조건이 완비 됐는지 확인 하는 거에요.
**사후조건** 은 메서드 실행 되고 난 결과가 정상적인지 판단하는 거고,
**불변식** 은 클래스의 모든 인스턴스가 생성 된 후에 만족스러운 결과를 확인하는 거래요.

~~근데 C# 에는 특이한 문법 많네요~~

 ## 03 계약에 의한 설계와 서브 타이핑
 계약에 의한 설계의 핵심은 **클라이언트와 서버 사이의 견교한 협력을 위해 규칙을 정의하는 것** 이라고 이번 장의 답을 제시해 주네요.

아하! C#에 있던 것처럼 자바에는 `assert` 가 있었네요. 유닛 테스트 만들 때나 한 두번 써보고 안써봤는데...
이거 은근 심오한 거였네요. 그리고 **사전조건** 은 `assert` 로 한다쳐도 사후는 어떡해... ???

#### 서브타입에 더 강력한 사전조건을 정의할 수 없다
사전조건을 만족시키는 건 클라이언트의 책임!
메세지를 던지기 전에 알아서 잘 다듬고 던지란 얘긴가....

#### 서브타입에 더 완화된 사후조건을 정의할 수 없다
사후조건을 위반한 책임은 전적으로 서버!

> **일찍 실패하기 (Fail Fast) **
> 이건 스프링이 짱이잖아요. 일단 Spring Bean 들이 정상적이지 않으면 어플리케이션 안띄워주는 거.
> __프로그램을 멈추는 것이 최선일 때가 있다__ 라고 말씀하시네요. 공감~

#### 슈퍼타입의 불변식은 서브타입에서도 반드시 유지돼야 한다

### 가변성 규칙

#### 서브타입은 슈퍼타입이 발생시키는 예외와 다른 타입의 예외를 발생시켜서는 안된다
이 짓은 저도 잘하는 편인 것 같아요. 여러 예외를 처리하기 귀찮아서 뭉텅이로 버무려서 `IllegalStateException` 정도로 바꿔 버리곤 나중에 에러 처리 복잡하다고 불평하는...
예상 가능한 상황을 보장해 줘야 하는 것 같네요.

#### 서브타입의 리턴 타입은 공변성을 가져야 한다

> **공변성 共變性**
> 한 변수가 변하면 다른 변수도 변하는 성질.

말이 이해가 안돼서 뭔소린지 모르겠네요. 다형성으로 치환이 가능한 상태를 얘기하는 것 같네요.
C# 은 무공변성으로 상속으로 Override 된 메서드가 공변성이 없다는데... 꽤 불편할 것 같은 느낌이네요.

#### 서브타입의 메서드 파라미터는 반공변성을 가져야 한다
반공변성은 메서드의 파라미터 타입으로 설명하는데 꽤 난해 하군요. 그래놓고선 서브타입 대신 슈퍼타입을 파라미터로 받는 것은 더 약한 사후조건을 정의하는 거라며 계약 위반이 아니라고...
음... 저만 이해가 잘 안되는건지... 뭔가 말이 엄청 복잡한 것 같아요 ㅠㅜ

### 함수 타입과 서브타이핑
진정한 서브타이핑 관계를 만들려면 서브타입에 더 강력한 사전조건이나 더 완화된 사후조건을 정의해서는 안되며 슈퍼타입의 불변식을 유지하기 위해 노력해야 한대요.
그리고 서브타입에서는 슈퍼타입에 정의하지 않은 예외를 던지지 말고요.

썸머리라고 쉽게 생각해서 그런건지... 대체로 잘 이해 안되네요.
왠지 책을 대충 본 것 같은 느낌도 들고... 후회와 반성과 회한과 실망...
