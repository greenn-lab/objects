# 설계 품질과 트레이드오프

## 데이터 중심의 영화 예매 시스템
```java
class Movie {
  private String title;
  private Duration runningTime;
  private Money fee;
  private List<DiscountCondition> discountConditions;

  private MovieType movieType;
  private Money discountAmount;
  private double discountPercent;
}
```
```java
enum MovieType {
  AMOUNT_DISCOUNT,
  PERCENT_DISCOUNT,
  NON_DISCOUNT
}
```

`MovieType` 에 따라서 영화 할인 정책이 결정되는거죠.
`Movie` 에 `@Getter` `@Setter` 를 달아서 필드 노출은 막는대요.

```java
enum DiscountConditionType {
  SEQUENCE, PERIOD
}
```

```java
@Getter @Setter
class DiscountCondition {
  private DiscountConditionType type;

  private int sequence;

  private DayOfWeek dayOfWeek;
  private LocalTime startTime;
  private LocalTime endTime;
}
```
할인 조건은 이렇게.

```java
@Getter @Setter
class Screening {
  private Movie movie;
  private int sequence;
  private LocalDateTime whenScreened;
}
```
이렇게 상영을 담당하는 클래스.

```java
@Getter @Setter
@AllArgsConstructor
class Reservation {
  private Customer customer;
  private Screening screening;
  private Money fee;
  private int audienceCount;
}
```
예매를 하는 거죠.

```java
@Getter @Setter
class Customer {
  private String nane;
  private String id;
}
```

그래도 뭔가 구성요소는 다 갖춰진 듯 해보네요.  
자, 이제 구매 절차를 구현 해보면
```java
class ReservationAgency {
  Reservation reserve(Screening screening, Customer customer, int audienceCount) {
    Movie movie = screening.getMovie();

    boolean discountable = false;
    for (DiscountCondition condition : movie.getDiscountConditions()) {
      if (DiscountConditionType.PERIOD == condition.getType()) {
        discountable = screening.getWhenScreened().getDayOfWeek().equals(condition.getDayOfWeek()) &&
          condition.getStartTime().compareTo(screening.getWhenScreened().toLocalTime()) <= 0 &&
          condition.getEndTime().compareTo(screening.getWhenScreened().toLocalTime()) >= 0;
      }
      else {
        discountable = condition.getSequence() == screening.getSequence();
      }

      if (discountable)
        break;
    }

    Money fee;
    if (discountable) {
      Money discountAmount = Money.ZERO;
      switch (movie.getMovieType()) {
        case AMOUNT_DISCOUNT:
          discountAmount = movie.getDiscountAmount();
          break;
        case PERCENT_DISCOUNT:
          discountAmount = movie.getFee().times(movie.getDiscountPercent());
          break;
        case NONE_DISCOUNT:
          discountAmount = Money.ZERO;
          break;
      }

      fee = movie.getFee().minus(discountAmount).times(audienceCount);
    }
    else {
      fee = movie.getFee();
    }

    return new Reservation(customer, screening, fee, audienceCount);
  }
}
```